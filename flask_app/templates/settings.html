{% extends "base.html" %}

{% block title %}Settings - MultiPlex Stats{% endblock %}

{% block content %}
<header>
    <h1 class="settings-title">Settings</h1>
    <div class="subtitle">Configure Your Tautulli Servers & Analytics Preferences</div>
</header>

<div class="settings-container">
    <div class="settings-section">
        <h2 class="section-title">
            <svg class="section-icon" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                <rect x="2" y="3" width="20" height="14" rx="2" ry="2"></rect>
                <line x1="8" y1="21" x2="16" y2="21"></line>
                <line x1="12" y1="17" x2="12" y2="21"></line>
            </svg>
            Server Configuration
        </h2>

        {% if servers %}
            <div class="server-list">
                {% for server in servers %}
                <div class="server-item">
                    <div class="server-info">
                        <h3>{{ server.name }}</h3>
                        <p>{{ "https" if server.use_ssl else "http" }}://{{ server.ip_address }}</p>
                        <p class="server-meta">Order: {{ "ServerA" if server.server_order == 0 else "ServerB" }}{% if server.use_ssl %} | SSL: ✓{% endif %}</p>
                    </div>
                    <div class="server-actions">
                        <form method="POST" action="{{ url_for('settings.delete_server', server_id=server.id) }}" style="display: inline;">
                            <button type="submit" class="btn btn-danger" onclick="return confirm('Are you sure you want to delete this server?');">Delete</button>
                        </form>
                    </div>
                </div>
                {% endfor %}
            </div>
        {% else %}
            <p class="info-message">No servers configured. Add your first server below.</p>
        {% endif %}

        <div class="form-card">
            <h3>Add/Update Server</h3>
            <form method="POST" action="{{ url_for('settings.add_server') }}">
                <div class="form-group">
                    <label for="name">Server Name</label>
                    <input type="text" id="name" name="name" required placeholder="e.g., Server1">
                </div>

                <div class="form-group">
                    <label for="ip_address">IP Address:Port</label>
                    <input type="text" id="ip_address" name="ip_address" required placeholder="e.g., 192.168.1.101:8181">
                    <small>Include the port number</small>
                </div>

                <div class="form-group">
                    <label for="api_key">API Key</label>
                    <input type="text" id="api_key" name="api_key" required placeholder="Your Tautulli API key">
                    <small>Find in Tautulli: Settings → Web Interface → API</small>
                </div>

                <div class="form-group checkbox-group">
                    <label>
                        <input type="checkbox" id="use_ssl" name="use_ssl" value="1">
                        Use HTTPS/SSL
                    </label>
                    <small>Check this if your Tautulli server uses HTTPS</small>
                </div>

                <div class="form-group checkbox-group">
                    <label>
                        <input type="checkbox" id="verify_ssl" name="verify_ssl" value="1">
                        Verify SSL Certificate
                    </label>
                    <small>Check this only if using HTTPS with a valid certificate</small>
                </div>

                <div class="form-group">
                    <label for="server_order">Server Order</label>
                    <select id="server_order" name="server_order">
                        <option value="0">Server A (Primary)</option>
                        <option value="1">Server B (Secondary)</option>
                    </select>
                </div>

                <button type="submit" class="btn btn-primary">Save Server</button>
            </form>
        </div>

        <div class="import-section">
            <h3>Import from config.ini</h3>
            <p>Already have a config.ini file? Import your existing configuration.</p>
            <form method="POST" action="{{ url_for('settings.import_from_ini') }}">
                <button type="submit" class="btn btn-secondary">Import from config.ini</button>
            </form>
        </div>
    </div>

    <div class="settings-section">
        <h2 class="section-title">
            <svg class="section-icon" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                <line x1="18" y1="20" x2="18" y2="10"></line>
                <line x1="12" y1="20" x2="12" y2="4"></line>
                <line x1="6" y1="20" x2="6" y2="14"></line>
            </svg>
            Analytics Settings
        </h2>

        <div class="form-card">
            <form method="POST" action="{{ url_for('settings.update_analytics_settings') }}">
                <div class="form-group">
                    <label for="daily_trend_days">Daily Trend Days</label>
                    <input type="number" id="daily_trend_days" name="daily_trend_days"
                           value="{{ settings.daily_trend_days if settings else 60 }}" min="1" max="365">
                    <small>Number of days to show in daily chart</small>
                </div>

                <div class="form-group">
                    <label for="monthly_trend_months">Monthly Trend Months</label>
                    <input type="number" id="monthly_trend_months" name="monthly_trend_months"
                           value="{{ settings.monthly_trend_months if settings else 60 }}" min="1" max="120">
                    <small>Number of months to show in monthly chart</small>
                </div>

                <div class="form-group">
                    <label for="history_days">History Days</label>
                    <input type="number" id="history_days" name="history_days"
                           value="{{ settings.history_days if settings else 60 }}" min="1" max="365">
                    <small>Days of history for user/content analysis</small>
                </div>

                <div class="form-group">
                    <label for="history_table_days">Viewing History Table Days</label>
                    <input type="number" id="history_table_days" name="history_table_days"
                           value="{{ settings.history_table_days if settings else 60 }}" min="1" max="365">
                    <small>Number of days to display in viewing history table</small>
                </div>

                <div class="form-group">
                    <label for="top_movies">Top Movies Count</label>
                    <input type="number" id="top_movies" name="top_movies"
                           value="{{ settings.top_movies if settings else 30 }}" min="1" max="100">
                </div>

                <div class="form-group">
                    <label for="top_tv_shows">Top TV Shows Count</label>
                    <input type="number" id="top_tv_shows" name="top_tv_shows"
                           value="{{ settings.top_tv_shows if settings else 30 }}" min="1" max="100">
                </div>

                <div class="form-group">
                    <label for="top_users">Top Users Count</label>
                    <input type="number" id="top_users" name="top_users"
                           value="{{ settings.top_users if settings else 20 }}" min="1" max="100">
                </div>

                <button type="submit" class="btn btn-primary">Save Analytics Settings</button>
            </form>
        </div>
    </div>
</div>
{% endblock %}
