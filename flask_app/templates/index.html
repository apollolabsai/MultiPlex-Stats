{% extends "base.html" %}

{% block title %}Home - MultiPlex Stats{% endblock %}

{% block content %}
<header>
    <img src="{{ url_for('static', filename='logo.png') }}" alt="MultiPlex Stats" style="max-width: 400px; height: auto; margin-bottom: 10px;">
    <div class="subtitle">Web Interface for Tautulli Analytics</div>
</header>

{% if not has_config %}
<div class="welcome-card">
    <h2>Welcome to MultiPlex Stats!</h2>
    <p>Get started by configuring your Tautulli server connection.</p>
    <a href="{{ url_for('settings.index') }}" class="btn btn-primary btn-large">
        <svg class="button-icon" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
            <circle cx="12" cy="12" r="3"></circle>
            <path d="M12 1v6m0 6v6m5.196-14.196l-4.242 4.242m0 5.908l-4.242 4.242m14.196-5.196l-6 0m-6 0l-6 0m14.196 5.196l-4.242-4.242m0-5.908l-4.242-4.242"></path>
        </svg>
        Go to Settings
    </a>
</div>
{% else %}
<div class="action-card">
    <h2>Run Analytics</h2>
    <p>Execute analytics on your configured Tautulli servers.</p>

    {% if servers %}
    <div class="server-status">
        <h3>Configured Servers:</h3>
        <ul>
            {% for server in servers %}
            <li>{{ server.name }} ({{ server.ip_address }})</li>
            {% endfor %}
        </ul>
    </div>
    {% endif %}

    <form method="POST" action="{{ url_for('main.run_analytics') }}">
        <button type="submit" class="btn btn-success btn-large">▶️ Run Analytics</button>
    </form>
    <p class="info-text">This will take 30-60 seconds to complete.</p>
</div>

{% if last_run %}
<div class="status-card">
    <h2>Last Run Status</h2>
    <div class="status-info">
        <p><strong>Status:</strong>
            {% if last_run.status == 'success' %}
                <span class="badge badge-success">✓ Success</span>
            {% elif last_run.status == 'failed' %}
                <span class="badge badge-error">✗ Failed</span>
            {% else %}
                <span class="badge badge-info">⟳ Running</span>
            {% endif %}
        </p>
        <p><strong>Started:</strong> {{ last_run.started_at.strftime('%Y-%m-%d %H:%M:%S') }}</p>
        {% if last_run.completed_at %}
        <p><strong>Completed:</strong> {{ last_run.completed_at.strftime('%Y-%m-%d %H:%M:%S') }}</p>
        {% endif %}

        {% if last_run.status == 'success' %}
        <p><strong>Total Plays:</strong> {{ "{:,}".format(last_run.total_plays) }}</p>
        <p><strong>Active Users:</strong> {{ last_run.total_users }}</p>
        <a href="{{ url_for('main.dashboard') }}" class="btn btn-primary">View Dashboard</a>
        {% endif %}

        {% if last_run.status == 'failed' and last_run.error_message %}
        <div class="error-message">
            <strong>Error:</strong> {{ last_run.error_message }}
        </div>
        {% endif %}
    </div>
</div>
{% endif %}
{% endif %}

<div class="info-section">
    <h2>About MultiPlex Stats</h2>
    <p>MultiPlex Stats provides comprehensive analytics for your Plex Media Server using Tautulli data.</p>
    <ul>
        <li>Track viewing trends over time</li>
        <li>Identify your most active users</li>
        <li>Discover your most popular content</li>
        <li>Compare statistics across multiple servers</li>
        <li>Beautiful interactive charts powered by Plotly</li>
    </ul>
</div>
{% endblock %}
